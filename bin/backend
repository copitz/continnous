#!/usr/bin/env node
const program = require('commander');

program
  .option('-e, --env <env>', 'The firebase environment to use', process.env.FB_ENV)
  .parse(process.argv);

process.env.FB_ENV = program.env;

const Utils = require('./lib/Utils');
const Backends = [
  require('./lib/backend/NotifyAdminsOnMembershipRequest')
];
const backends = {};

Utils.fb.database().ref('organizations').on('child_added', (osn) => {
  const organization = osn.val();
  organization.key = osn.key;
  backends[organization.key] = [];
  Backends.forEach((Backend) => {
    backends[organization.key].push(new Backend(organization, Utils.fb, Utils.rc));
  });
});
Utils.fb.database().ref('organizations').on('child_changed', (osn) => {
  const organization = osn.val();
  organization.key = osn.key;
  backends[organization.key].forEach((backend) => {
    backend.updateOrganization(organization);
  });
});
